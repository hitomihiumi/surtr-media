{
  "$schema": "https://encore.dev/schemas/infra.schema.json",
  "metadata": {
    "app_id": "mediavault",
    "env_name": "production",
    "env_type": "production",
    "cloud": "custom"
  },

  "sql_servers": [
    {
      "host": "${POSTGRES_HOST}",
      "tls_config": {
        "disabled": false
      }
    }
  ],

  "sql_databases": {
    "auth": {
      "server_id": 0,
      "database": "mediavault_auth",
      "username": "${POSTGRES_USER}",
      "password": {"$env": "POSTGRES_PASSWORD"}
    },
    "media": {
      "server_id": 0,
      "database": "mediavault_media",
      "username": "${POSTGRES_USER}",
      "password": {"$env": "POSTGRES_PASSWORD"}
    },
    "collection": {
      "server_id": 0,
      "database": "mediavault_collection",
      "username": "${POSTGRES_USER}",
      "password": {"$env": "POSTGRES_PASSWORD"}
    },
    "processing": {
      "server_id": 0,
      "database": "mediavault_processing",
      "username": "${POSTGRES_USER}",
      "password": {"$env": "POSTGRES_PASSWORD"}
    }
  },

  "pubsub": [
    {
      "type": "gcp_pubsub",
      "project_id": "${GCP_PROJECT_ID}"
    }
  ],

  "pubsub_topics": {
    "media-uploaded": {
      "provider_id": 0,
      "name": "media-uploaded",
      "subscriptions": {
        "processing-worker": {
          "push_config": null
        }
      }
    }
  },

  "redis_servers": [],

  "secrets": {
    "DiscordClientID": {"$env": "DISCORD_CLIENT_ID"},
    "DiscordClientSecret": {"$env": "DISCORD_CLIENT_SECRET"},
    "SessionSecret": {"$env": "SESSION_SECRET"}
  },

  "service_configs": {
    "auth": {
      "env": {
        "DISCORD_REDIRECT_URL": "${DISCORD_REDIRECT_URL}"
      }
    },
    "media": {
      "env": {
        "S3_ENDPOINT": "${S3_ENDPOINT}",
        "S3_ACCESS_KEY": "${S3_ACCESS_KEY}",
        "S3_SECRET_KEY": "${S3_SECRET_KEY}",
        "S3_BUCKET": "${S3_BUCKET}",
        "S3_USE_SSL": "${S3_USE_SSL}"
      }
    },
    "processing": {
      "env": {
        "S3_ENDPOINT": "${S3_ENDPOINT}",
        "S3_ACCESS_KEY": "${S3_ACCESS_KEY}",
        "S3_SECRET_KEY": "${S3_SECRET_KEY}",
        "S3_BUCKET": "${S3_BUCKET}",
        "S3_USE_SSL": "${S3_USE_SSL}"
      }
    },
    "collection": {}
  },

  "gateways": {
    "api-gateway": {
      "base_url": "${API_BASE_URL}",
      "cors": {
        "allow_origins_without_credentials": ["*"],
        "allow_origins_with_credentials": ["${FRONTEND_URL}"],
        "allow_headers": ["Authorization", "Content-Type"],
        "expose_headers": ["Content-Length"],
        "allow_private_network_access": false
      }
    }
  },

  "auth": [],

  "graceful_shutdown": {
    "total_time": "30s",
    "handlers_time": "25s"
  },

  "metrics": {
    "type": "prometheus",
    "remote_write": []
  },

  "tracing": {
    "type": "encore"
  }
}

